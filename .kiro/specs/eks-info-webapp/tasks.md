# 实施计划

**作者：** RJ.Wang  
**邮箱：** wangrenjun@gmail.com  
**创建时间：** 2025-11-13

## 任务列表

- [x] 1. 创建项目基础结构和配置
  - 创建 Python 项目目录结构
  - 配置 requirements.txt 依赖文件
  - 创建 Flask 应用主文件 app.py
  - 配置日志和错误处理
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6_

- [x] 2. 实现环境信息收集服务
  - [x] 2.1 实现 EnvironmentService 类
    - 实现 get_pod_info() 方法获取 Pod 信息
    - 实现 get_node_info() 方法获取 Node 信息
    - 实现 get_cluster_info() 方法获取集群信息
    - 实现 get_ec2_metadata() 方法从 EC2 元数据服务获取实例信息
    - 实现 get_system_info() 方法获取系统信息
    - 实现 get_architecture_info() 方法检测 ARM64 架构
    - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 11.3_

- [x] 3. 实现 Kubernetes API 交互服务
  - [x] 3.1 实现 KubernetesService 类
    - 初始化 Kubernetes 客户端（in-cluster 配置）
    - 实现 get_current_pod() 方法
    - 实现 get_pods() 方法列出命名空间中的 Pod
    - 实现 get_nodes() 方法列出集群节点
    - 实现 get_services() 方法
    - 实现 get_deployments() 方法
    - 实现 get_hpa() 方法获取 HPA 配置
    - 实现 get_pvcs() 方法获取 PVC 信息
    - 实现 get_events() 方法获取事件列表
    - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 4. 实现 AWS API 交互服务
  - [x] 4.1 实现 AWSService 类
    - 初始化 boto3 客户端（使用 IRSA 自动获取凭证）
    - 实现 get_ec2_instance_info() 方法
    - 实现 get_vpc_info() 方法
    - 实现 get_subnet_info() 方法
    - 实现 get_security_groups() 方法
    - 实现 get_ebs_volume_info() 方法
    - 实现 get_efs_filesystem_info() 方法
    - 实现 get_load_balancers() 方法
    - _需求: 7.1, 7.2, 7.3, 7.4, 7.5, 9.1, 9.4_

- [x] 5. 实现 EBS 存储访问
  - [x] 5.1 实现 EBSStorage 类
    - 实现 __init__() 方法初始化挂载路径
    - 实现 write_log() 方法写入访问日志
    - 实现 read_logs() 方法读取日志记录
    - 实现 get_disk_usage() 方法获取磁盘使用情况
    - 实现 cleanup_old_logs() 方法清理旧日志
    - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_
  - [x] 5.2 实现 EBS 演示路由
    - 创建 /ebs 路由显示 EBS 信息
    - 实现写入数据功能
    - 实现读取数据功能
    - 实现自动记录访问日志
    - _需求: 3.1, 3.2, 3.3, 3.4_

- [x] 6. 实现 EFS 共享文件系统访问
  - [x] 6.1 实现 EFSStorage 类
    - 实现 __init__() 方法初始化挂载路径
    - 实现 write_file() 方法写入文件
    - 实现 read_file() 方法读取文件
    - 实现 list_files() 方法列出所有文件
    - 实现 delete_file() 方法删除文件
    - 实现 get_filesystem_usage() 方法获取文件系统使用情况
    - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_
  - [x] 6.2 实现 EFS 演示路由
    - 创建 /efs 路由显示 EFS 信息
    - 实现写入数据功能（包含 Pod 名称）
    - 实现读取所有 Pod 写入的数据
    - 显示当前处理请求的 Pod 名称
    - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 7. 实现 S3 对象存储访问
  - [x] 7.1 实现 S3Storage 类
    - 实现 __init__() 方法初始化 S3 客户端和存储桶
    - 实现 upload_object() 方法上传对象
    - 实现 download_object() 方法下载对象
    - 实现 list_objects() 方法列出对象
    - 实现 delete_object() 方法删除对象
    - 实现 get_bucket_info() 方法获取存储桶信息
    - _需求: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 9.1_
  - [x] 7.2 实现 S3 演示路由
    - 创建 /s3 路由显示 S3 信息
    - 实现上传数据功能
    - 实现列出对象功能
    - 实现下载对象功能
    - 实现删除对象功能
    - 显示 IRSA 角色信息
    - _需求: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [x] 8. 实现存储概览功能
  - [x] 8.1 实现 StorageService 类
    - 实现 get_mount_points() 方法获取所有挂载点
    - 实现 get_ebs_info() 方法获取 EBS 配置
    - 实现 get_efs_info() 方法获取 EFS 配置
    - 实现 get_s3_info() 方法获取 S3 配置
    - _需求: 2.1, 2.2, 2.3, 2.4_
  - [x] 8.2 创建存储概览路由
    - 创建 /storage 路由
    - 显示所有存储卷信息
    - 提供到各存储演示页面的导航
    - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 9. 实现压力测试功能
  - [x] 9.1 实现 StressTestService 类
    - 实现 start_cpu_stress() 方法执行 CPU 压力测试
    - 实现 start_memory_stress() 方法执行内存压力测试
    - 实现 get_stress_status() 方法获取测试状态
    - 实现 stop_stress() 方法停止测试
    - 实现 get_current_cpu_usage() 方法获取 CPU 使用率
    - 实现 get_current_memory_usage() 方法获取内存使用情况
    - _需求: 12.1, 12.2, 12.3, 12.6, 13.1, 13.2, 13.3, 13.6_
  - [x] 9.2 创建压力测试路由
    - 创建 /stress 路由显示压力测试界面
    - 实现启动 CPU 压力测试功能
    - 实现启动内存压力测试功能
    - 实时显示 CPU 和内存使用率
    - 显示测试配置选项（持续时间、强度）
    - _需求: 12.1, 12.2, 12.3, 12.6, 13.1, 13.2, 13.3, 13.6_

- [x] 10. 实现扩展监控功能
  - [x] 10.1 实现 MetricsService 类
    - 实现 record_access() 方法记录访问信息
    - 实现 get_access_stats() 方法获取访问统计
    - 实现 record_scaling_event() 方法记录扩展事件
    - 实现 get_scaling_history() 方法获取扩展历史
    - 实现 get_resource_trends() 方法获取资源趋势
    - _需求: 15.1, 15.2, 15.3, 15.4, 15.5_
  - [x] 10.2 创建扩展监控路由
    - 创建 /scaling 路由显示扩展监控界面
    - 显示当前节点列表和资源使用
    - 显示每个节点上的 Pod 分布
    - 检测并显示 Pending 状态的 Pod
    - 显示 HPA 当前状态和副本数
    - 提供刷新按钮更新状态
    - _需求: 14.1, 14.2, 14.3, 14.4, 14.5, 14.6_
  - [x] 10.3 创建扩展历史路由
    - 创建 /scaling/history 路由
    - 显示 Pod 数量变化图表
    - 显示节点数量变化图表
    - 显示扩展事件列表
    - 显示扩展响应时间统计
    - 显示资源使用率趋势
    - _需求: 15.1, 15.2, 15.3, 15.4, 15.5_

- [x] 11. 实现网络信息展示
  - [x] 11.1 创建网络信息路由
    - 创建 /network 路由
    - 显示 VPC 详细信息
    - 显示所有子网信息
    - 显示安全组规则
    - 显示路由表配置
    - 显示 Load Balancer 信息
    - _需求: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 12. 实现 Kubernetes 资源信息展示
  - [x] 12.1 创建资源信息路由
    - 创建 /resources 路由
    - 显示命名空间中的 Pod 列表
    - 显示 Service 信息
    - 显示 Deployment 配置
    - 显示节点资源使用情况
    - 显示 PV 和 PVC 状态
    - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 13. 实现首页和健康检查
  - [x] 13.1 创建首页路由
    - 创建 / 路由显示环境信息
    - 显示 Pod 基本信息
    - 显示集群信息
    - 显示 EC2 实例信息
    - 显示系统架构信息（ARM64）
    - 显示网络架构信息
    - 显示环境变量
    - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6_
  - [x] 13.2 实现健康检查端点
    - 创建 /health 端点返回基本健康状态
    - 创建 /ready 端点检查存储可用性
    - 实现启动时的初始化检查
    - 实现存储系统的可用性检查
    - _需求: 8.1, 8.2, 8.3, 8.4_

- [x] 14. 实现 Web 界面
  - [x] 14.1 创建基础 HTML 模板
    - 创建 base.html 基础模板
    - 实现导航菜单
    - 实现响应式布局
    - 添加 CSS 样式
    - _需求: 10.1, 10.2_
  - [x] 14.2 创建各功能页面模板
    - 创建 index.html（首页）
    - 创建 storage.html（存储概览）
    - 创建 ebs.html（EBS 演示）
    - 创建 efs.html（EFS 演示）
    - 创建 s3.html（S3 演示）
    - 创建 network.html（网络信息）
    - 创建 resources.html（K8S 资源）
    - 创建 stress.html（压力测试）
    - 创建 scaling.html（扩展监控）
    - _需求: 10.1, 10.2, 10.3, 10.4, 10.5_
  - [x] 14.3 实现交互功能
    - 添加加载指示器
    - 实现错误消息显示
    - 实现状态颜色编码
    - 添加表单验证
    - _需求: 10.3, 10.4, 10.5_

- [x] 15. 构建 Docker 镜像
  - [x] 15.1 创建 Dockerfile
    - 使用 ARM64 Python 基础镜像
    - 配置工作目录和依赖安装
    - 复制应用代码
    - 配置健康检查
    - 设置启动命令
    - _需求: 11.1, 11.2, 11.4, 11.5_
  - [x] 15.2 构建和测试镜像
    - 使用 docker buildx 构建 ARM64 镜像
    - 本地测试镜像运行
    - 验证所有依赖库兼容 ARM64
    - _需求: 11.1, 11.4, 11.5_

- [x] 16. 创建 Kubernetes 资源配置
  - [x] 16.1 创建基础资源配置
    - 创建 namespace.yaml
    - 创建 serviceaccount.yaml（配置 IRSA 注解）
    - 创建 service.yaml（ClusterIP）
    - 创建 ingress.yaml（ALB 配置）
    - _需求: 9.1, 9.2_
  - [x] 16.2 创建存储资源配置
    - 创建 storageclass-ebs.yaml（gp3）
    - 创建 storageclass-efs.yaml
    - 创建 pvc-ebs.yaml（ReadWriteOnce）
    - 创建 pvc-efs.yaml（ReadWriteMany）
    - _需求: 2.2, 2.3_
  - [x] 16.3 创建应用部署配置
    - 创建 deployment.yaml
    - 配置资源限制（CPU 和内存）
    - 配置卷挂载（EBS 和 EFS）
    - 配置环境变量（Pod 信息、S3 桶名）
    - 配置健康检查探针
    - _需求: 8.1, 8.2, 8.3_
  - [x] 16.4 创建 HPA 配置
    - 创建 hpa.yaml
    - 配置 CPU 和内存指标
    - 配置扩展策略（最小 3，最大 10）
    - 配置扩展行为（稳定窗口、扩展速率）
    - _需求: 12.4, 12.5, 13.4, 13.5_

- [x] 17. 创建 Terraform 配置
  - [x] 17.1 创建 EFS 文件系统资源
    - 在 main.tf 中添加 aws_efs_file_system 资源
    - 配置加密和性能模式
    - 创建 EFS 挂载目标（每个私有子网）
    - 配置安全组允许 NFS 访问
    - _需求: 2.3, 4.1_
  - [x] 17.2 创建 S3 存储桶资源
    - 在 main.tf 中添加 aws_s3_bucket 资源
    - 配置存储桶加密
    - 配置生命周期策略
    - 添加存储桶标签
    - _需求: 2.4, 5.1_
  - [x] 17.3 创建 IAM 角色和策略
    - 创建 IRSA IAM 角色
    - 配置信任策略（OIDC Provider）
    - 创建 S3 访问策略
    - 创建 EC2/EFS 描述权限策略
    - 附加策略到角色
    - _需求: 9.1, 9.2, 9.3, 9.4_
  - [x] 17.4 安装 EBS 和 EFS CSI Driver
    - 使用 Helm 安装 EBS CSI Driver
    - 使用 Helm 安装 EFS CSI Driver
    - 配置 CSI Driver 的 IAM 角色
    - _需求: 2.2, 2.3_
  - [x] 17.5 部署应用到 EKS
    - 使用 kubectl provider 部署 Kubernetes 资源
    - 配置依赖关系确保正确的部署顺序
    - 输出应用访问地址
    - _需求: 所有需求_

- [x] 18. 创建部署脚本和文档
  - [x] 18.1 创建部署脚本
    - 创建 build.sh 脚本构建和推送镜像
    - 创建 deploy.sh 脚本部署应用
    - 添加错误检查和日志输出
    - _需求: 所有需求_
  - [x] 18.2 更新项目文档
    - 更新 README.md 添加应用说明
    - 添加架构图和使用说明
    - 添加故障排除指南
    - _需求: 所有需求_

- [x] 19. 集成测试和验证
  - [x] 19.1 验证存储功能
    - 测试 EBS 写入和读取
    - 测试 EFS 多 Pod 共享
    - 测试 S3 上传和下载
    - 验证 IRSA 权限正常工作
    - _需求: 3.1-3.5, 4.1-4.5, 5.1-5.6_
  - [x] 19.2 验证压力测试和扩展
    - 执行 CPU 压力测试
    - 验证 HPA 触发 Pod 扩展
    - 执行内存压力测试
    - 验证节点自动扩展（如果配置）
    - 检查扩展事件记录
    - _需求: 12.1-12.6, 13.1-13.6, 14.1-14.6, 15.1-15.5_
  - [x] 19.3 验证环境信息展示
    - 验证所有环境信息正确显示
    - 验证 ARM64 架构检测
    - 验证网络信息准确
    - 验证 K8S 资源信息完整
    - _需求: 1.1-1.6, 6.1-6.5, 7.1-7.5, 11.1-11.5_
  - [x] 19.4 验证健康检查和错误处理
    - 测试健康检查端点
    - 测试存储不可用时的错误处理
    - 测试 API 调用失败的重试机制
    - 验证日志记录正常
    - _需求: 8.1-8.5, 9.4, 9.5_
