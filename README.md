# EKS Info WebApp - EKS ç¯å¢ƒä¿¡æ¯å±•ç¤ºåº”ç”¨

è¿™æ˜¯ä¸€ä¸ªéƒ¨ç½²åœ¨ Amazon EKS ä¸Šçš„ Python Flask Web åº”ç”¨ï¼Œç”¨äºæ¼”ç¤ºå’Œå±•ç¤º EKS ç¯å¢ƒä¿¡æ¯ã€AWS å­˜å‚¨æœåŠ¡è®¿é—®ï¼ˆEBSã€EFSã€S3ï¼‰ä»¥åŠ Kubernetes è‡ªåŠ¨æ‰©å±•èƒ½åŠ›ã€‚

## ä½œè€…ä¿¡æ¯

- **ä½œè€…**: RJ.Wang
- **é‚®ç®±**: wangrenjun@gmail.com
- **åˆ›å»ºæ—¶é—´**: 2025-11-13
- **é¡¹ç›®**: EKS Info WebApp - EKS ç¯å¢ƒä¿¡æ¯å±•ç¤ºåº”ç”¨

## åº”ç”¨åŠŸèƒ½

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ–¥ï¸ **ç¯å¢ƒä¿¡æ¯å±•ç¤º**: Podã€Nodeã€é›†ç¾¤ã€EC2 å®ä¾‹ã€ç½‘ç»œæ¶æ„ä¿¡æ¯
- ğŸ’¾ **å­˜å‚¨æœåŠ¡æ¼”ç¤º**: EBSã€EFSã€S3 ä¸‰ç§å­˜å‚¨æœåŠ¡çš„å®é™…è®¿é—®æ¼”ç¤º
- ğŸ“Š **èµ„æºç›‘æ§**: Kubernetes èµ„æºä½¿ç”¨æƒ…å†µå’ŒçŠ¶æ€ç›‘æ§
- ğŸ”„ **è‡ªåŠ¨æ‰©å±•**: HPA å’Œ Cluster Autoscaler æ¼”ç¤º
- ğŸ§ª **å‹åŠ›æµ‹è¯•**: CPU å’Œå†…å­˜å‹åŠ›æµ‹è¯•ï¼Œè§¦å‘è‡ªåŠ¨æ‰©å±•
- ğŸŒ **ç½‘ç»œå¯è§†åŒ–**: VPCã€å­ç½‘ã€å®‰å…¨ç»„ã€è·¯ç”±è¡¨ä¿¡æ¯å±•ç¤º

### å­˜å‚¨åŠŸèƒ½
- **EBS (å—å­˜å‚¨)**: å• Pod æŒä¹…åŒ–æ—¥å¿—ï¼Œæ¼”ç¤º ReadWriteOnce è®¿é—®æ¨¡å¼
- **EFS (å…±äº«æ–‡ä»¶ç³»ç»Ÿ)**: å¤š Pod å…±äº«æ–‡ä»¶ï¼Œæ¼”ç¤º ReadWriteMany è®¿é—®æ¨¡å¼
- **S3 (å¯¹è±¡å­˜å‚¨)**: é€šè¿‡ IRSA å®‰å…¨è®¿é—®ï¼Œæ¼”ç¤ºå¯¹è±¡ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤

### æŠ€æœ¯ç‰¹æ€§
- ğŸš€ **ä¸€é”®éƒ¨ç½²**: è‡ªåŠ¨åˆ›å»º EKS é›†ç¾¤ã€VPCã€åº”ç”¨ç­‰æ‰€æœ‰èµ„æº
- ğŸ§¹ **ä¸€é”®æ¸…ç†**: è‡ªåŠ¨åˆ é™¤æ‰€æœ‰åˆ›å»ºçš„ AWS èµ„æºï¼Œé¿å…äº§ç”Ÿä¸å¿…è¦è´¹ç”¨
- ğŸ“Š **æ™ºèƒ½æ¢å¤**: è‡ªåŠ¨æ£€æµ‹å’Œæ¢å¤éƒ¨ç½²é—®é¢˜
- ğŸ’° **æˆæœ¬é€æ˜**: æ¸…æ™°æ˜¾ç¤ºé¢„ä¼°æˆæœ¬å’Œèµ„æºä½¿ç”¨æƒ…å†µ
- ğŸ”§ **å·¥å…·æ£€æŸ¥**: è‡ªåŠ¨æ£€æŸ¥æ‰€éœ€å·¥å…·å’Œ AWS å‡­è¯
- ğŸ“‹ **è¯¦ç»†æ—¥å¿—**: æä¾›è¯¦ç»†çš„éƒ¨ç½²ä¿¡æ¯å’Œç®¡ç†å‘½ä»¤
- ğŸ—ï¸ **ARM64 æ”¯æŒ**: è¿è¡Œåœ¨ AWS Graviton å¤„ç†å™¨ä¸Šï¼Œæ€§èƒ½å’Œæˆæœ¬ä¼˜åŒ–

## åº”ç”¨æ¶æ„

### æ•´ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Internet / User                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Application Load Balancer                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Kubernetes Ingress                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Kubernetes Service (ClusterIP)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                  â–¼                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Pod 1 â”‚          â”‚ Pod 2 â”‚          â”‚ Pod 3 â”‚
    â”‚       â”‚          â”‚       â”‚          â”‚       â”‚
    â”‚ Flask â”‚          â”‚ Flask â”‚          â”‚ Flask â”‚
    â”‚  App  â”‚          â”‚  App  â”‚          â”‚  App  â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”˜          â””â”€â”€â”€â”¬â”€â”€â”€â”˜          â””â”€â”€â”€â”¬â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”
    â”‚  EBS  â”‚          â”‚  EFS  â”‚          â”‚  S3   â”‚
    â”‚ (PVC) â”‚          â”‚(Shared)â”‚         â”‚(IRSA) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç½‘ç»œæ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AWS VPC                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Public AZ-A   â”‚  â”‚   Public AZ-B   â”‚  â”‚ Public AZ-C  â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚              â”‚ â”‚
â”‚  â”‚   NAT Gateway   â”‚  â”‚   NAT Gateway   â”‚  â”‚ NAT Gateway  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Private AZ-A   â”‚  â”‚  Private AZ-B   â”‚  â”‚ Private AZ-C â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚              â”‚ â”‚
â”‚  â”‚  EKS Nodes      â”‚  â”‚  EKS Nodes      â”‚  â”‚  EKS Nodes   â”‚ â”‚
â”‚  â”‚  + EFS Mount    â”‚  â”‚  + EFS Mount    â”‚  â”‚  + EFS Mount â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## éƒ¨ç½²çš„èµ„æº

### ç½‘ç»œåŸºç¡€è®¾æ–½
- **VPC**: 10.101.0.0/16 CIDR
- **å…¬æœ‰å­ç½‘**: 3ä¸ªå¯ç”¨åŒºï¼Œæ¯ä¸ª /24
- **ç§æœ‰å­ç½‘**: 6ä¸ªå­ç½‘ï¼ˆæ¯ä¸ªå¯ç”¨åŒº2ä¸ªï¼‰ï¼Œæ¯ä¸ª /24
- **NAT Gateway**: 3ä¸ªï¼ˆæ¯ä¸ªå¯ç”¨åŒº1ä¸ªï¼‰
- **Internet Gateway**: 1ä¸ª
- **è·¯ç”±è¡¨**: å…¬æœ‰å’Œç§æœ‰è·¯ç”±è¡¨

### EKS é›†ç¾¤
- **EKS é›†ç¾¤**: Kubernetes 1.31
- **èŠ‚ç‚¹ç»„**: t3.medium ARM64 å®ä¾‹ï¼Œ2-4ä¸ªèŠ‚ç‚¹
- **IAM è§’è‰²**: é›†ç¾¤å’ŒèŠ‚ç‚¹ç»„æ‰€éœ€çš„è§’è‰²å’Œç­–ç•¥
- **å®‰å…¨ç»„**: é›†ç¾¤ã€èŠ‚ç‚¹ã€EFS çš„å®‰å…¨ç»„é…ç½®
- **OIDC Provider**: ç”¨äº IRSA è®¤è¯

### å­˜å‚¨èµ„æº
- **EFS æ–‡ä»¶ç³»ç»Ÿ**: åŠ å¯†çš„å…±äº«æ–‡ä»¶ç³»ç»Ÿï¼Œå¸¦æŒ‚è½½ç›®æ ‡
- **S3 å­˜å‚¨æ¡¶**: åŠ å¯†çš„å¯¹è±¡å­˜å‚¨ï¼Œé…ç½®ç”Ÿå‘½å‘¨æœŸç­–ç•¥
- **EBS CSI Driver**: é€šè¿‡ Helm å®‰è£…ï¼Œæ”¯æŒåŠ¨æ€å·ä¾›åº”
- **EFS CSI Driver**: é€šè¿‡ Helm å®‰è£…ï¼Œæ”¯æŒå…±äº«æ–‡ä»¶ç³»ç»Ÿ
- **StorageClass**: EBS gp3 å’Œ EFS å­˜å‚¨ç±»
- **PVC**: EBS (10Gi) å’Œ EFS (20Gi) æŒä¹…å·å£°æ˜

### åº”ç”¨ç»„ä»¶
- **Namespace**: rj-webdemo
- **ServiceAccount**: é…ç½® IRSA æ³¨è§£ï¼Œç”¨äº S3 è®¿é—®
- **Deployment**: EKS Info Appï¼Œ3ä¸ªå‰¯æœ¬ï¼Œé…ç½®èµ„æºé™åˆ¶å’Œå¥åº·æ£€æŸ¥
- **Service**: ClusterIP æœåŠ¡
- **Ingress**: ALB Ingress Controller é…ç½®
- **HPA**: æ°´å¹³ Pod è‡ªåŠ¨æ‰©å±•å™¨ï¼ˆ3-10 å‰¯æœ¬ï¼‰
- **Load Balancer**: Application Load Balancer

### IAM å’Œæƒé™
- **EKS Info App IAM è§’è‰²**: S3 è®¿é—®å’Œ AWS æœåŠ¡æè¿°æƒé™
- **CSI Driver IAM è§’è‰²**: EBS å’Œ EFS æ“ä½œæƒé™
- **ALB Controller IAM è§’è‰²**: è´Ÿè½½å‡è¡¡å™¨ç®¡ç†æƒé™
- **IRSA é…ç½®**: å®‰å…¨çš„ä¸´æ—¶å‡­è¯æœºåˆ¶

## å‰ç½®è¦æ±‚

### å¿…éœ€å·¥å…·
- [Terraform](https://www.terraform.io/downloads.html) >= 1.3.2
- [kubectl](https://kubernetes.io/docs/tasks/tools/) >= 1.28
- [Helm](https://helm.sh/docs/intro/install/) >= 3.0
- [AWS CLI](https://aws.amazon.com/cli/) >= 2.0

### AWS é…ç½®
```bash
# é…ç½® AWS å‡­è¯
aws configure

# æˆ–è®¾ç½®ç¯å¢ƒå˜é‡
export AWS_ACCESS_KEY_ID="your-access-key"
export AWS_SECRET_ACCESS_KEY="your-secret-key"
export AWS_DEFAULT_REGION="ap-southeast-1"
```

### IAM æƒé™
ç¡®ä¿ AWS ç”¨æˆ·å…·æœ‰ä»¥ä¸‹æƒé™ï¼š
- EC2 å®Œå…¨è®¿é—®æƒé™
- EKS å®Œå…¨è®¿é—®æƒé™
- IAM è§’è‰²å’Œç­–ç•¥ç®¡ç†æƒé™
- VPC å’Œç½‘ç»œèµ„æºç®¡ç†æƒé™
- Application Load Balancer ç®¡ç†æƒé™

## å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: æ„å»ºå’Œæ¨é€ Docker é•œåƒ

```bash
# æ„å»º ARM64 é•œåƒå¹¶æ¨é€åˆ° ECR
./scripts/build.sh

# æˆ–è€…æŒ‡å®šæ ‡ç­¾
./scripts/build.sh -t v1.0

# æŸ¥çœ‹å¸®åŠ©
./scripts/build.sh --help
```

### æ­¥éª¤ 2: éƒ¨ç½²é›†ç¾¤å’Œåº”ç”¨

```bash
# ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰
./scripts/deploy.sh

# æˆ–æ˜ç¡®æŒ‡å®šéƒ¨ç½²
./scripts/deploy.sh deploy
```

éƒ¨ç½²è¿‡ç¨‹åŒ…æ‹¬ï¼š
1. âœ… å·¥å…·å’Œå‡­è¯æ£€æŸ¥
2. ğŸ”§ Terraform åˆå§‹åŒ–
3. ğŸ“‹ ç”Ÿæˆæ‰§è¡Œè®¡åˆ’
4. âš ï¸ ç¡®è®¤éƒ¨ç½²ï¼ˆéœ€è¦è¾“å…¥ 'yes'ï¼‰
5. ğŸš€ åˆ›å»ºåŸºç¡€è®¾æ–½ï¼ˆ15-20åˆ†é’Ÿï¼‰
   - VPC å’Œç½‘ç»œèµ„æº
   - EKS é›†ç¾¤å’ŒèŠ‚ç‚¹ç»„
   - EFS æ–‡ä»¶ç³»ç»Ÿå’Œ S3 å­˜å‚¨æ¡¶
   - CSI Driver å®‰è£…
6. ğŸ”§ é…ç½® kubectl
7. ğŸ“¦ éƒ¨ç½²åº”ç”¨å’Œ Kubernetes èµ„æº
8. â³ ç­‰å¾…åº”ç”¨å°±ç»ª
9. ğŸ“Š æ˜¾ç¤ºè®¿é—®ä¿¡æ¯

### æ­¥éª¤ 3: è®¿é—®åº”ç”¨

éƒ¨ç½²å®Œæˆåï¼Œè®¿é—®è¾“å‡ºçš„ ALB åœ°å€ï¼š

```
ğŸŒ åº”ç”¨è®¿é—®åœ°å€:
   http://your-alb-hostname.region.elb.amazonaws.com
```

åº”ç”¨é¡µé¢åŒ…æ‹¬ï¼š
- **é¦–é¡µ (/)**: ç¯å¢ƒä¿¡æ¯å±•ç¤º
- **/storage**: å­˜å‚¨æ¦‚è§ˆ
- **/ebs**: EBS å—å­˜å‚¨æ¼”ç¤º
- **/efs**: EFS å…±äº«æ–‡ä»¶ç³»ç»Ÿæ¼”ç¤º
- **/s3**: S3 å¯¹è±¡å­˜å‚¨æ¼”ç¤º
- **/network**: ç½‘ç»œæ¶æ„ä¿¡æ¯
- **/resources**: Kubernetes èµ„æºä¿¡æ¯
- **/stress**: å‹åŠ›æµ‹è¯•å’Œè‡ªåŠ¨æ‰©å±•æ¼”ç¤º
- **/scaling**: æ‰©å±•ç›‘æ§å’Œå†å²

### æ­¥éª¤ 4: æ¸…ç†æ‰€æœ‰èµ„æº

```bash
./scripts/deploy.sh clean
```

æ¸…ç†è¿‡ç¨‹åŒ…æ‹¬ï¼š
1. âš ï¸ ç¡®è®¤åˆ é™¤ï¼ˆéœ€è¦è¾“å…¥ 'yes'ï¼‰
2. ğŸ—‘ï¸ åˆ é™¤ Kubernetes èµ„æº
3. ğŸ—‘ï¸ åˆ é™¤æ‰€æœ‰ AWS èµ„æºï¼ˆ10-15åˆ†é’Ÿï¼‰
4. ğŸ§¹ æ¸…ç†æœ¬åœ°æ–‡ä»¶

### æŸ¥çœ‹å¸®åŠ©

```bash
# éƒ¨ç½²è„šæœ¬å¸®åŠ©
./scripts/deploy.sh help

# æ„å»ºè„šæœ¬å¸®åŠ©
./scripts/build.sh --help
```

## æˆæœ¬ä¼°ç®—

### ä¸»è¦è´¹ç”¨ç»„ä»¶
- **EKS é›†ç¾¤**: ~$0.10/å°æ—¶
- **EC2 å®ä¾‹**: t3.medium Ã— 2-4ä¸ª â‰ˆ $0.08-0.16/å°æ—¶
- **NAT Gateway**: 3ä¸ª Ã— $0.045/å°æ—¶ â‰ˆ $0.135/å°æ—¶
- **Application Load Balancer**: ~$0.025/å°æ—¶
- **æ•°æ®ä¼ è¾“**: æ ¹æ®ä½¿ç”¨é‡

**æ€»è®¡**: çº¦ $2-4/å°æ—¶ï¼ˆæ ¹æ®åŒºåŸŸå’Œä½¿ç”¨æƒ…å†µï¼‰

âš ï¸ **é‡è¦**: æµ‹è¯•å®Œæˆåè¯·åŠæ—¶è¿è¡Œ `./scripts/deploy.sh clean` æ¸…ç†èµ„æºï¼

## éƒ¨ç½²åç®¡ç†

### è®¿é—®åº”ç”¨
éƒ¨ç½²å®Œæˆåï¼Œè„šæœ¬ä¼šæ˜¾ç¤ºåº”ç”¨çš„è®¿é—®åœ°å€ï¼š
```
ğŸŒ åº”ç”¨è®¿é—®åœ°å€:
   http://your-alb-hostname.region.elb.amazonaws.com
```

### å¸¸ç”¨ kubectl å‘½ä»¤
```bash
# æŸ¥çœ‹ Pod çŠ¶æ€
kubectl get pods -n rj-webdemo

# æŸ¥çœ‹æœåŠ¡
kubectl get services -n rj-webdemo

# æŸ¥çœ‹ Ingress
kubectl get ingress -n rj-webdemo

# æ‰©ç¼©å®¹åº”ç”¨
kubectl scale deployment rj-py-webdemo --replicas=5 -n rj-webdemo

# æŸ¥çœ‹ Pod æ—¥å¿—
kubectl logs -f deployment/rj-py-webdemo -n rj-webdemo
```

### Terraform å‘½ä»¤
```bash
# è¿›å…¥ Terraform ç›®å½•
cd terraform

# æŸ¥çœ‹è¾“å‡ºä¿¡æ¯
terraform output

# æŸ¥çœ‹çŠ¶æ€
terraform state list

# æŸ¥çœ‹ç‰¹å®šèµ„æº
terraform show

# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ..
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. Docker é•œåƒæ„å»ºå¤±è´¥

**é—®é¢˜**: Docker é•œåƒæºè®¿é—®å¤±è´¥
```
ERROR: failed to resolve reference "docker.io/library/python:3.11-slim"
```

**è§£å†³æ–¹æ¡ˆ**:
- ä¸´æ—¶ç¦ç”¨ Docker é•œåƒåŠ é€Ÿå™¨
- ç¼–è¾‘ `~/.docker/daemon.json`ï¼Œæ³¨é‡Šæ‰ `registry-mirrors`
- é‡å¯ Docker Desktop æˆ– Docker æœåŠ¡
- è¯¦è§ `eks-info-app/DOCKER_BUILD_GUIDE.md`

#### 2. Terraform éƒ¨ç½²å¤±è´¥

**é—®é¢˜**: Kubernetes provider è®¤è¯é”™è¯¯
```
Error: getting credentials: decoding stdout: couldn't get version/kind
```

**è§£å†³æ–¹æ¡ˆ**:
- è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶åˆ‡æ¢åˆ°æ··åˆéƒ¨ç½²æ¨¡å¼
- åŸºç¡€è®¾æ–½ç”± Terraform ç®¡ç†
- Kubernetes èµ„æºé€šè¿‡ kubectl/Helm éƒ¨ç½²
- æ— éœ€æ‰‹åŠ¨å¹²é¢„ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ¢å¤

#### 3. åº”ç”¨æ— æ³•è®¿é—®

**é—®é¢˜**: ALB åœ°å€æ— æ³•è®¿é—®

**è§£å†³æ–¹æ¡ˆ**:
- ç­‰å¾… ALB å®Œå…¨å°±ç»ªï¼ˆ2-3åˆ†é’Ÿï¼‰
- æ£€æŸ¥ Pod çŠ¶æ€ï¼š`kubectl get pods -n rj-webdemo`
- æ£€æŸ¥ Ingress çŠ¶æ€ï¼š`kubectl describe ingress -n rj-webdemo`
- æŸ¥çœ‹ ALB Controller æ—¥å¿—ï¼š
  ```bash
  kubectl logs -n kube-system -l app.kubernetes.io/name=aws-load-balancer-controller
  ```

#### 4. å­˜å‚¨æŒ‚è½½å¤±è´¥

**é—®é¢˜**: Pod æ— æ³•æŒ‚è½½ EBS æˆ– EFS

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ CSI Driver çŠ¶æ€ï¼š
  ```bash
  kubectl get pods -n kube-system | grep csi
  ```
- æ£€æŸ¥ PVC çŠ¶æ€ï¼š
  ```bash
  kubectl describe pvc -n rj-webdemo
  ```
- éªŒè¯ IAM è§’è‰²æƒé™
- æ£€æŸ¥å®‰å…¨ç»„é…ç½®ï¼ˆEFS éœ€è¦ NFS ç«¯å£ 2049ï¼‰

#### 5. IRSA æƒé™é—®é¢˜

**é—®é¢˜**: S3 è®¿é—®è¢«æ‹’ç»

**è§£å†³æ–¹æ¡ˆ**:
- éªŒè¯ ServiceAccount æ³¨è§£ï¼š
  ```bash
  kubectl get sa eks-info-app-sa -n rj-webdemo -o yaml
  ```
- æ£€æŸ¥ Pod ç¯å¢ƒå˜é‡ï¼š
  ```bash
  kubectl exec -n rj-webdemo -it <pod-name> -- env | grep AWS
  ```
- éªŒè¯ IAM è§’è‰²ä¿¡ä»»ç­–ç•¥
- ç¡®è®¤ OIDC Provider é…ç½®æ­£ç¡®

#### 6. kubectl è¿æ¥å¤±è´¥

**é—®é¢˜**: æ— æ³•è¿æ¥åˆ° EKS é›†ç¾¤

**è§£å†³æ–¹æ¡ˆ**:
- é‡æ–°é…ç½® kubeconfigï¼š
  ```bash
  aws --profile susermt eks update-kubeconfig \
    --region ap-southeast-1 \
    --name RJtest-eks-cluster-20250822
  ```
- éªŒè¯ AWS å‡­è¯ï¼š
  ```bash
  aws --profile susermt sts get-caller-identity
  ```

#### 7. æ¸…ç†å¤±è´¥

**é—®é¢˜**: Terraform destroy å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
- æ‰‹åŠ¨æ£€æŸ¥ AWS æ§åˆ¶å°ä¸­çš„èµ„æº
- ç¡®è®¤æ²¡æœ‰å…¶ä»–ä¾èµ–èµ„æºé˜»æ­¢åˆ é™¤
- æ‰‹åŠ¨åˆ é™¤ ALBï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- é‡æ–°è¿è¡Œæ¸…ç†å‘½ä»¤ï¼š`./scripts/deploy.sh clean`
- æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š`deployment.log`

### æ—¥å¿—æŸ¥çœ‹

```bash
# éƒ¨ç½²æ—¥å¿—
cat deployment.log

# Terraform è¯¦ç»†æ—¥å¿—
export TF_LOG=DEBUG
cd terraform
terraform apply
cd ..

# kubectl äº‹ä»¶
kubectl get events -n rj-webdemo

# Pod æ—¥å¿—
kubectl logs -n rj-webdemo -l app=eks-info-app --tail=100

# ALB Controller æ—¥å¿—
kubectl logs -n kube-system -l app.kubernetes.io/name=aws-load-balancer-controller --tail=100
```

### æ€§èƒ½è°ƒä¼˜

#### HPA è§¦å‘æµ‹è¯•
è®¿é—® `/stress` é¡µé¢ï¼Œæ‰§è¡Œ CPU æˆ–å†…å­˜å‹åŠ›æµ‹è¯•ï¼š
- CPU å‹åŠ›æµ‹è¯•ï¼šæŒç»­ 60 ç§’ï¼Œå¼ºåº¦å¯è°ƒ
- å†…å­˜å‹åŠ›æµ‹è¯•ï¼šåˆ†é…æŒ‡å®šå¤§å°å†…å­˜
- è§‚å¯Ÿ HPA è‡ªåŠ¨æ‰©å±• Pod æ•°é‡

#### æ‰‹åŠ¨æ‰©å±•
```bash
# æ‰‹åŠ¨æ‰©å±• Pod
kubectl scale deployment/eks-info-app --replicas=5 -n rj-webdemo

# æŸ¥çœ‹ HPA çŠ¶æ€
kubectl get hpa -n rj-webdemo

# æŸ¥çœ‹æ‰©å±•äº‹ä»¶
kubectl describe hpa eks-info-app-hpa -n rj-webdemo
```

## åº”ç”¨åŠŸèƒ½è¯¦è§£

### ç¯å¢ƒä¿¡æ¯å±•ç¤º (/)
- Pod åŸºæœ¬ä¿¡æ¯ï¼ˆåç§°ã€å‘½åç©ºé—´ã€IPã€èŠ‚ç‚¹ï¼‰
- Kubernetes é›†ç¾¤ä¿¡æ¯ï¼ˆç‰ˆæœ¬ã€API ç«¯ç‚¹ï¼‰
- EC2 å®ä¾‹ä¿¡æ¯ï¼ˆå®ä¾‹ IDã€ç±»å‹ã€å¯ç”¨åŒºï¼‰
- ç³»ç»Ÿæ¶æ„ä¿¡æ¯ï¼ˆARM64 æ£€æµ‹ï¼‰
- ç½‘ç»œé…ç½®ï¼ˆVPCã€å­ç½‘ã€å®‰å…¨ç»„ï¼‰
- ç¯å¢ƒå˜é‡åˆ—è¡¨

### å­˜å‚¨æ¦‚è§ˆ (/storage)
- æ‰€æœ‰æŒ‚è½½ç‚¹ä¿¡æ¯
- EBS å·é…ç½®å’Œä½¿ç”¨æƒ…å†µ
- EFS æ–‡ä»¶ç³»ç»Ÿé…ç½®
- S3 å­˜å‚¨æ¡¶é…ç½®å’Œ IRSA è§’è‰²
- å¯¼èˆªåˆ°å„å­˜å‚¨æ¼”ç¤ºé¡µé¢

### EBS æ¼”ç¤º (/ebs)
- æ˜¾ç¤º EBS å·ä¿¡æ¯å’Œç£ç›˜ä½¿ç”¨ç‡
- å†™å…¥è®¿é—®æ—¥å¿—ï¼ˆæ—¶é—´æˆ³ã€å†…å®¹ï¼‰
- è¯»å–å†å²æ—¥å¿—è®°å½•
- æ¼”ç¤ºå• Pod æŒä¹…åŒ–å­˜å‚¨
- éªŒè¯ Pod é‡å¯åæ•°æ®æŒä¹…æ€§

### EFS æ¼”ç¤º (/efs)
- æ˜¾ç¤º EFS æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯
- å†™å…¥æ–‡ä»¶ï¼ˆåŒ…å« Pod åç§°ï¼‰
- è¯»å–æ‰€æœ‰ Pod å†™å…¥çš„æ–‡ä»¶
- æ¼”ç¤ºå¤š Pod å…±äº«æ–‡ä»¶ç³»ç»Ÿ
- æ˜¾ç¤ºå½“å‰å¤„ç†è¯·æ±‚çš„ Pod

### S3 æ¼”ç¤º (/s3)
- æ˜¾ç¤º S3 å­˜å‚¨æ¡¶ä¿¡æ¯
- ä¸Šä¼ å¯¹è±¡åˆ° S3
- åˆ—å‡ºæ‰€æœ‰å¯¹è±¡
- ä¸‹è½½å¯¹è±¡å†…å®¹
- åˆ é™¤å¯¹è±¡
- æ˜¾ç¤º IRSA è§’è‰²ä¿¡æ¯

### ç½‘ç»œä¿¡æ¯ (/network)
- VPC è¯¦ç»†ä¿¡æ¯ï¼ˆCIDRã€DNS è®¾ç½®ï¼‰
- æ‰€æœ‰å­ç½‘ä¿¡æ¯ï¼ˆå…¬æœ‰/ç§æœ‰ï¼‰
- å®‰å…¨ç»„è§„åˆ™ï¼ˆå…¥ç«™/å‡ºç«™ï¼‰
- è·¯ç”±è¡¨é…ç½®
- Load Balancer ä¿¡æ¯

### Kubernetes èµ„æº (/resources)
- Pod åˆ—è¡¨å’ŒçŠ¶æ€
- Service ä¿¡æ¯
- Deployment é…ç½®
- èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ
- PV å’Œ PVC çŠ¶æ€

### å‹åŠ›æµ‹è¯• (/stress)
- CPU å‹åŠ›æµ‹è¯•ï¼ˆå¯é…ç½®æŒç»­æ—¶é—´å’Œå¼ºåº¦ï¼‰
- å†…å­˜å‹åŠ›æµ‹è¯•ï¼ˆå¯é…ç½®ç›®æ ‡å†…å­˜å¤§å°ï¼‰
- å®æ—¶æ˜¾ç¤º CPU å’Œå†…å­˜ä½¿ç”¨ç‡
- è§¦å‘ HPA è‡ªåŠ¨æ‰©å±•
- æ˜¾ç¤ºæµ‹è¯•çŠ¶æ€å’Œç»“æœ

### æ‰©å±•ç›‘æ§ (/scaling)
- å½“å‰èŠ‚ç‚¹åˆ—è¡¨å’Œèµ„æºä½¿ç”¨
- æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ Pod åˆ†å¸ƒ
- Pending çŠ¶æ€ Pod æ£€æµ‹
- HPA å½“å‰çŠ¶æ€å’Œå‰¯æœ¬æ•°
- æ‰©å±•äº‹ä»¶å†å²
- èµ„æºä½¿ç”¨ç‡è¶‹åŠ¿

## æŠ€æœ¯æ ˆ

### åç«¯
- **Python 3.11**: åº”ç”¨è¿è¡Œæ—¶
- **Flask 3.0**: Web æ¡†æ¶
- **boto3**: AWS SDK for Python
- **kubernetes**: Kubernetes Python Client
- **psutil**: ç³»ç»Ÿä¿¡æ¯æ”¶é›†
- **gunicorn**: WSGI HTTP æœåŠ¡å™¨

### åŸºç¡€è®¾æ–½
- **Terraform**: åŸºç¡€è®¾æ–½å³ä»£ç 
- **AWS EKS**: Kubernetes æ‰˜ç®¡æœåŠ¡
- **AWS VPC**: ç½‘ç»œéš”ç¦»
- **AWS EFS**: å…±äº«æ–‡ä»¶ç³»ç»Ÿ
- **AWS S3**: å¯¹è±¡å­˜å‚¨
- **AWS EBS**: å—å­˜å‚¨

### Kubernetes ç»„ä»¶
- **Deployment**: åº”ç”¨éƒ¨ç½²
- **Service**: æœåŠ¡å‘ç°
- **Ingress**: æµé‡è·¯ç”±
- **HPA**: è‡ªåŠ¨æ‰©å±•
- **PVC**: æŒä¹…å·å£°æ˜
- **ServiceAccount**: IRSA è®¤è¯

### å­˜å‚¨é©±åŠ¨
- **EBS CSI Driver**: åŠ¨æ€ EBS å·ä¾›åº”
- **EFS CSI Driver**: EFS æ–‡ä»¶ç³»ç»ŸæŒ‚è½½
- **AWS Load Balancer Controller**: ALB ç®¡ç†

## æ–‡ä»¶ç»“æ„

```
.
â”œâ”€â”€ README.md                     # æœ¬æ–‡æ¡£
â”œâ”€â”€ DEPLOYMENT.md                 # éƒ¨ç½²æŒ‡å—ï¼ˆåˆå¹¶ï¼‰
â”œâ”€â”€ PROJECT_SUMMARY.md            # é¡¹ç›®æ€»ç»“ï¼ˆåˆå¹¶ï¼‰
â”œâ”€â”€ BUGFIX_REPORT.md              # Bug ä¿®å¤æŠ¥å‘Šï¼ˆåˆå¹¶ï¼‰
â”œâ”€â”€ TROUBLESHOOTING.md            # æ•…éšœæ’é™¤
â”œâ”€â”€ .gitignore                    # Git å¿½ç•¥æ–‡ä»¶
â”‚
â”œâ”€â”€ terraform/                    # Terraform ä»£ç 
â”‚   â”œâ”€â”€ main.tf                   # åŸºç¡€è®¾æ–½å®šä¹‰
â”‚   â”œâ”€â”€ app.tf                    # åº”ç”¨èµ„æºå®šä¹‰
â”‚   â”œâ”€â”€ variables.tf              # å˜é‡å®šä¹‰
â”‚   â”œâ”€â”€ outputs.tf                # è¾“å‡ºå®šä¹‰
â”‚   â”œâ”€â”€ versions.tf               # Terraform ç‰ˆæœ¬çº¦æŸ
â”‚   â”œâ”€â”€ terraform.tfvars          # å˜é‡å€¼
â”‚   â”œâ”€â”€ .terraform.lock.hcl       # Provider ç‰ˆæœ¬é”å®š
â”‚   â””â”€â”€ .terraform/               # Terraform å·¥ä½œç›®å½•
â”‚
â”œâ”€â”€ scripts/                      # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ build.sh                  # é•œåƒæ„å»ºå’Œæ¨é€è„šæœ¬
â”‚   â”œâ”€â”€ deploy.sh                 # ä¸»éƒ¨ç½²è„šæœ¬ï¼ˆæ™ºèƒ½ç‰ˆï¼‰
â”‚   â”œâ”€â”€ get-alb-hostname.sh       # è·å– ALB åœ°å€è„šæœ¬
â”‚   â”œâ”€â”€ test_all_pages.sh         # é¡µé¢æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ verify_environment_info.sh # ç¯å¢ƒéªŒè¯è„šæœ¬
â”‚   â””â”€â”€ verify_frontend.sh        # å‰ç«¯éªŒè¯è„šæœ¬
â”‚
â”œâ”€â”€ k8s/                          # Kubernetes æ¸…å•æ–‡ä»¶
â”‚   â”œâ”€â”€ namespace.yaml
â”‚   â”œâ”€â”€ serviceaccount.yaml
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â”œâ”€â”€ ingress.yaml
â”‚   â”œâ”€â”€ hpa.yaml
â”‚   â”œâ”€â”€ README.md
â”‚   â””â”€â”€ storage/                  # å­˜å‚¨é…ç½®
â”‚       â”œâ”€â”€ storageclass-ebs.yaml
â”‚       â”œâ”€â”€ storageclass-efs.yaml
â”‚       â”œâ”€â”€ pvc-ebs.yaml
â”‚       â””â”€â”€ pvc-efs.yaml
â”‚
â”œâ”€â”€ eks-info-app/                 # åº”ç”¨æºä»£ç 
â”‚   â”œâ”€â”€ app.py                    # Flask åº”ç”¨ä¸»æ–‡ä»¶
â”‚   â”œâ”€â”€ config.py                 # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ main.py                   # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ requirements.txt          # Python ä¾èµ–
â”‚   â”œâ”€â”€ Dockerfile                # Docker é•œåƒå®šä¹‰
â”‚   â”œâ”€â”€ build.sh                  # Docker æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ push-to-ecr.sh            # ECR æ¨é€è„šæœ¬
â”‚   â”œâ”€â”€ README.md                 # åº”ç”¨è¯´æ˜
â”‚   â”œâ”€â”€ API_DOCUMENTATION.md      # API æ–‡æ¡£ï¼ˆåˆå¹¶ï¼‰
â”‚   â”œâ”€â”€ DOCKER_BUILD_GUIDE.md     # Docker æ„å»ºæŒ‡å—
â”‚   â”œâ”€â”€ services/                 # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ environment_service.py
â”‚   â”‚   â”œâ”€â”€ kubernetes_service.py
â”‚   â”‚   â”œâ”€â”€ aws_service.py
â”‚   â”‚   â”œâ”€â”€ storage_service.py
â”‚   â”‚   â”œâ”€â”€ stress_test_service.py
â”‚   â”‚   â””â”€â”€ metrics_service.py
â”‚   â”œâ”€â”€ storage/                  # å­˜å‚¨è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ ebs_storage.py
â”‚   â”‚   â”œâ”€â”€ efs_storage.py
â”‚   â”‚   â””â”€â”€ s3_storage.py
â”‚   â”œâ”€â”€ routes/                   # è·¯ç”±å¤„ç†
â”‚   â”‚   â”œâ”€â”€ home_routes.py
â”‚   â”‚   â”œâ”€â”€ storage_routes.py
â”‚   â”‚   â”œâ”€â”€ ebs_routes.py
â”‚   â”‚   â”œâ”€â”€ efs_routes.py
â”‚   â”‚   â”œâ”€â”€ s3_routes.py
â”‚   â”‚   â”œâ”€â”€ network_routes.py
â”‚   â”‚   â”œâ”€â”€ resources_routes.py
â”‚   â”‚   â”œâ”€â”€ stress_routes.py
â”‚   â”‚   â””â”€â”€ scaling_routes.py
â”‚   â”œâ”€â”€ templates/                # HTML æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ base.html
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”œâ”€â”€ storage.html
â”‚   â”‚   â”œâ”€â”€ ebs.html
â”‚   â”‚   â”œâ”€â”€ efs.html
â”‚   â”‚   â”œâ”€â”€ s3.html
â”‚   â”‚   â”œâ”€â”€ network.html
â”‚   â”‚   â”œâ”€â”€ resources.html
â”‚   â”‚   â”œâ”€â”€ stress.html
â”‚   â”‚   â””â”€â”€ scaling.html
â”‚   â”œâ”€â”€ static/                   # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ js/
â”‚   â””â”€â”€ tests/                    # æµ‹è¯•æ–‡ä»¶
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ conftest.py
â”‚       â”œâ”€â”€ test_*.py
â”‚       â””â”€â”€ ...
â”‚
â””â”€â”€ .kiro/                        # Kiro è§„èŒƒæ–‡ä»¶
    â””â”€â”€ specs/
        â”œâ”€â”€ eks-info-webapp/
        â”‚   â”œâ”€â”€ requirements.md
        â”‚   â”œâ”€â”€ design.md
        â”‚   â””â”€â”€ tasks.md
        â””â”€â”€ project-cleanup/
            â”œâ”€â”€ requirements.md
            â”œâ”€â”€ design.md
            â””â”€â”€ tasks.md
```

## éƒ¨ç½²æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    1. æ„å»º Docker é•œåƒ                      â”‚
â”‚  ./scripts/build.sh                                         â”‚
â”‚  â€¢ æ„å»º ARM64 é•œåƒ                                          â”‚
â”‚  â€¢ æ¨é€åˆ° ECR                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2. åˆå§‹åŒ– Terraform                      â”‚
â”‚  terraform init                                             â”‚
â”‚  â€¢ ä¸‹è½½ Provider æ’ä»¶                                       â”‚
â”‚  â€¢ åˆå§‹åŒ–åç«¯                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    3. åˆ›å»ºåŸºç¡€è®¾æ–½                          â”‚
â”‚  terraform apply                                            â”‚
â”‚  â€¢ VPC å’Œç½‘ç»œ (5 åˆ†é’Ÿ)                                      â”‚
â”‚  â€¢ EKS é›†ç¾¤ (10 åˆ†é’Ÿ)                                       â”‚
â”‚  â€¢ èŠ‚ç‚¹ç»„ (5 åˆ†é’Ÿ)                                          â”‚
â”‚  â€¢ EFS å’Œ S3 (2 åˆ†é’Ÿ)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    4. å®‰è£… CSI Driver                       â”‚
â”‚  Helm install                                               â”‚
â”‚  â€¢ EBS CSI Driver                                           â”‚
â”‚  â€¢ EFS CSI Driver                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    5. éƒ¨ç½²åº”ç”¨                              â”‚
â”‚  kubectl apply                                              â”‚
â”‚  â€¢ Namespace                                                â”‚
â”‚  â€¢ ServiceAccount (IRSA)                                    â”‚
â”‚  â€¢ StorageClass å’Œ PVC                                      â”‚
â”‚  â€¢ Deployment                                               â”‚
â”‚  â€¢ Service å’Œ Ingress                                       â”‚
â”‚  â€¢ HPA                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    6. å®‰è£… ALB Controller                   â”‚
â”‚  Helm install                                               â”‚
â”‚  â€¢ AWS Load Balancer Controller                             â”‚
â”‚  â€¢ åˆ›å»º ALB (2-3 åˆ†é’Ÿ)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    7. åº”ç”¨å°±ç»ª                              â”‚
â”‚  â€¢ Pod è¿è¡Œä¸­                                               â”‚
â”‚  â€¢ ALB å¥åº·æ£€æŸ¥é€šè¿‡                                         â”‚
â”‚  â€¢ å¯ä»¥è®¿é—®åº”ç”¨                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å®‰å…¨æœ€ä½³å®è·µ

### 1. å‡­è¯ç®¡ç†
- âœ… ä½¿ç”¨ IRSA æœºåˆ¶ï¼Œä¸ç¡¬ç¼–ç  AWS å‡­è¯
- âœ… ä¸´æ—¶å‡­è¯è‡ªåŠ¨è½®æ¢
- âœ… ä¸åœ¨ä»£ç æˆ–æ—¥å¿—ä¸­æš´éœ²æ•æ„Ÿä¿¡æ¯
- âœ… ä½¿ç”¨ AWS Secrets Manager å­˜å‚¨æ•æ„Ÿé…ç½®ï¼ˆå¯é€‰ï¼‰

### 2. ç½‘ç»œå®‰å…¨
- âœ… Pod è¿è¡Œåœ¨ç§æœ‰å­ç½‘ï¼Œæ— å…¬ç½‘ IP
- âœ… é€šè¿‡ NAT Gateway è®¿é—®äº’è”ç½‘
- âœ… ALB åœ¨å…¬æœ‰å­ç½‘ï¼Œæ¥æ”¶å¤–éƒ¨æµé‡
- âœ… å®‰å…¨ç»„é™åˆ¶æµé‡ï¼ˆä»…å…è®¸å¿…è¦ç«¯å£ï¼‰
- âœ… EFS è®¿é—®é™åˆ¶åœ¨ EKS èŠ‚ç‚¹å®‰å…¨ç»„

### 3. IAM æƒé™
- âœ… æœ€å°æƒé™åŸåˆ™
- âœ… æ¯ä¸ªç»„ä»¶ç‹¬ç«‹çš„ IAM è§’è‰²
- âœ… æ˜ç¡®çš„èµ„æºçº§æƒé™
- âœ… å®šæœŸå®¡è®¡æƒé™ä½¿ç”¨

### 4. æ•°æ®åŠ å¯†
- âœ… EBS å·åŠ å¯†ï¼ˆé™æ€åŠ å¯†ï¼‰
- âœ… EFS æ–‡ä»¶ç³»ç»ŸåŠ å¯†ï¼ˆé™æ€åŠ å¯†ï¼‰
- âœ… S3 å­˜å‚¨æ¡¶åŠ å¯†ï¼ˆAES256ï¼‰
- âœ… ä¼ è¾“ä¸­åŠ å¯†ï¼ˆHTTPS/TLSï¼‰

### 5. å®¹å™¨å®‰å…¨
- âœ… ä½¿ç”¨å®˜æ–¹ Python åŸºç¡€é•œåƒ
- âœ… å®šæœŸæ›´æ–°ä¾èµ–åŒ…
- âœ… é•œåƒæ‰«æï¼ˆECR è‡ªåŠ¨æ‰«æï¼‰
- âœ… é root ç”¨æˆ·è¿è¡Œï¼ˆå¯é€‰ï¼‰
- âœ… åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿï¼ˆå¯é€‰ï¼‰

### 6. Kubernetes å®‰å…¨
- âœ… RBAC æƒé™æ§åˆ¶
- âœ… Pod Security Standards
- âœ… Network Policiesï¼ˆå¯é€‰ï¼‰
- âœ… èµ„æºé™åˆ¶å’Œé…é¢
- âœ… å¥åº·æ£€æŸ¥å’Œå°±ç»ªæ¢é’ˆ

### 7. ç›‘æ§å’Œå®¡è®¡
- âœ… CloudWatch æ—¥å¿—é›†æˆ
- âœ… EKS æ§åˆ¶å¹³é¢æ—¥å¿—
- âœ… CloudTrail API å®¡è®¡
- âœ… èµ„æºæ ‡ç­¾ç”¨äºæˆæœ¬åˆ†é…

## ä½¿ç”¨ç¤ºä¾‹

### æ¼”ç¤ºå­˜å‚¨åŠŸèƒ½

#### 1. EBS å—å­˜å‚¨æ¼”ç¤º
```bash
# è®¿é—® EBS é¡µé¢
curl http://<alb-hostname>/ebs

# å†™å…¥æ•°æ®
curl -X POST http://<alb-hostname>/ebs/write \
  -H "Content-Type: application/json" \
  -d '{"content": "Test data from curl"}'

# è¯»å–æ•°æ®
curl http://<alb-hostname>/ebs/read
```

#### 2. EFS å…±äº«æ–‡ä»¶ç³»ç»Ÿæ¼”ç¤º
```bash
# è®¿é—® EFS é¡µé¢
curl http://<alb-hostname>/efs

# å†™å…¥æ–‡ä»¶ï¼ˆå¤šæ¬¡è°ƒç”¨ä¼šè¢«ä¸åŒ Pod å¤„ç†ï¼‰
for i in {1..5}; do
  curl -X POST http://<alb-hostname>/efs/write \
    -H "Content-Type: application/json" \
    -d "{\"content\": \"Test from curl - $i\"}"
  sleep 1
done

# è¯»å–æ‰€æœ‰æ–‡ä»¶
curl http://<alb-hostname>/efs/list
```

#### 3. S3 å¯¹è±¡å­˜å‚¨æ¼”ç¤º
```bash
# ä¸Šä¼ å¯¹è±¡
curl -X POST http://<alb-hostname>/s3/upload \
  -H "Content-Type: application/json" \
  -d '{"key": "test.txt", "content": "Hello S3"}'

# åˆ—å‡ºå¯¹è±¡
curl http://<alb-hostname>/s3/list

# ä¸‹è½½å¯¹è±¡
curl http://<alb-hostname>/s3/download/test.txt

# åˆ é™¤å¯¹è±¡
curl -X DELETE http://<alb-hostname>/s3/delete/test.txt
```

### æ¼”ç¤ºè‡ªåŠ¨æ‰©å±•

#### 1. è§¦å‘ CPU å‹åŠ›æµ‹è¯•
```bash
# å¯åŠ¨ CPU å‹åŠ›æµ‹è¯•
curl -X POST http://<alb-hostname>/stress/cpu \
  -H "Content-Type: application/json" \
  -d '{"duration": 120, "intensity": 80}'

# è§‚å¯Ÿ HPA æ‰©å±•
watch kubectl get hpa -n rj-webdemo

# æŸ¥çœ‹ Pod æ•°é‡å˜åŒ–
watch kubectl get pods -n rj-webdemo
```

#### 2. è§¦å‘å†…å­˜å‹åŠ›æµ‹è¯•
```bash
# å¯åŠ¨å†…å­˜å‹åŠ›æµ‹è¯•
curl -X POST http://<alb-hostname>/stress/memory \
  -H "Content-Type: application/json" \
  -d '{"duration": 120, "target_mb": 200}'

# è§‚å¯Ÿæ‰©å±•äº‹ä»¶
kubectl describe hpa eks-info-app-hpa -n rj-webdemo
```

### ç›‘æ§å’Œç®¡ç†

#### æŸ¥çœ‹åº”ç”¨çŠ¶æ€
```bash
# æŸ¥çœ‹æ‰€æœ‰ Pod
kubectl get pods -n rj-webdemo -o wide

# æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯
kubectl describe pod <pod-name> -n rj-webdemo

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
kubectl logs -f deployment/eks-info-app -n rj-webdemo

# æŸ¥çœ‹å¤šä¸ª Pod çš„æ—¥å¿—
kubectl logs -f -l app=eks-info-app -n rj-webdemo --max-log-requests=10
```

#### æŸ¥çœ‹å­˜å‚¨çŠ¶æ€
```bash
# æŸ¥çœ‹ PVC
kubectl get pvc -n rj-webdemo

# æŸ¥çœ‹ PV
kubectl get pv

# æŸ¥çœ‹ StorageClass
kubectl get storageclass

# æŸ¥çœ‹ EFS æŒ‚è½½
kubectl exec -n rj-webdemo -it <pod-name> -- df -h /data/efs

# æŸ¥çœ‹ EBS æŒ‚è½½
kubectl exec -n rj-webdemo -it <pod-name> -- df -h /data/ebs
```

#### æŸ¥çœ‹ç½‘ç»œçŠ¶æ€
```bash
# æŸ¥çœ‹ Service
kubectl get svc -n rj-webdemo

# æŸ¥çœ‹ Ingress
kubectl get ingress -n rj-webdemo

# æŸ¥çœ‹ ALB è¯¦ç»†ä¿¡æ¯
kubectl describe ingress eks-info-app-ingress -n rj-webdemo

# è·å– ALB åœ°å€
./scripts/get-alb-hostname.sh
```

#### æ‰‹åŠ¨æ‰©å±•
```bash
# æ‰©å±•åˆ° 5 ä¸ªå‰¯æœ¬
kubectl scale deployment/eks-info-app --replicas=5 -n rj-webdemo

# ç¼©å‡åˆ° 2 ä¸ªå‰¯æœ¬
kubectl scale deployment/eks-info-app --replicas=2 -n rj-webdemo

# æŸ¥çœ‹æ‰©å±•çŠ¶æ€
kubectl get deployment eks-info-app -n rj-webdemo
```

### è°ƒè¯•æŠ€å·§

#### è¿›å…¥ Pod è°ƒè¯•
```bash
# è¿›å…¥ Pod Shell
kubectl exec -n rj-webdemo -it <pod-name> -- /bin/bash

# æ£€æŸ¥ç¯å¢ƒå˜é‡
kubectl exec -n rj-webdemo -it <pod-name> -- env | grep -E "POD|AWS|S3"

# æµ‹è¯• S3 è®¿é—®
kubectl exec -n rj-webdemo -it <pod-name> -- \
  python -c "import boto3; print(boto3.client('s3').list_buckets())"

# æ£€æŸ¥å­˜å‚¨æŒ‚è½½
kubectl exec -n rj-webdemo -it <pod-name> -- ls -la /data/ebs /data/efs
```

#### æŸ¥çœ‹äº‹ä»¶å’Œæ—¥å¿—
```bash
# æŸ¥çœ‹å‘½åç©ºé—´äº‹ä»¶
kubectl get events -n rj-webdemo --sort-by='.lastTimestamp'

# æŸ¥çœ‹ Pod äº‹ä»¶
kubectl describe pod <pod-name> -n rj-webdemo | grep -A 10 Events

# æŸ¥çœ‹ ALB Controller æ—¥å¿—
kubectl logs -n kube-system -l app.kubernetes.io/name=aws-load-balancer-controller --tail=100

# æŸ¥çœ‹ CSI Driver æ—¥å¿—
kubectl logs -n kube-system -l app=ebs-csi-controller --tail=50
kubectl logs -n kube-system -l app=efs-csi-controller --tail=50
```

## æ€§èƒ½åŸºå‡†

### åº”ç”¨æ€§èƒ½
- **å¯åŠ¨æ—¶é—´**: 5-10 ç§’
- **å†…å­˜ä½¿ç”¨**: 100-150MBï¼ˆç©ºé—²ï¼‰
- **CPU ä½¿ç”¨**: <5%ï¼ˆç©ºé—²ï¼‰
- **å“åº”æ—¶é—´**: <100msï¼ˆæœ¬åœ°è¯·æ±‚ï¼‰

### å­˜å‚¨æ€§èƒ½
- **EBS gp3**: 3000 IOPSï¼Œ125 MB/s ååé‡
- **EFS**: å¯æ‰©å±•ï¼ŒæŒ‰ä½¿ç”¨é‡è®¡è´¹
- **S3**: é«˜å¯ç”¨ï¼Œ11ä¸ª9çš„æŒä¹…æ€§

### æ‰©å±•æ€§èƒ½
- **HPA å“åº”æ—¶é—´**: 30-60 ç§’
- **Pod å¯åŠ¨æ—¶é—´**: 10-20 ç§’
- **ALB å¥åº·æ£€æŸ¥**: 30 ç§’é—´éš”
- **æœ€å¤§å‰¯æœ¬æ•°**: 10ï¼ˆå¯é…ç½®ï¼‰

## ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æŒ‡å—](DEPLOYMENT.md) - å®Œæ•´çš„éƒ¨ç½²æµç¨‹å’Œè¯´æ˜
- [é¡¹ç›®æ€»ç»“](PROJECT_SUMMARY.md) - é¡¹ç›®å¼€å‘å†ç¨‹å’Œæ€»ç»“
- [Bug ä¿®å¤æŠ¥å‘Š](BUGFIX_REPORT.md) - Bug ä¿®å¤è®°å½•
- [æ•…éšœæ’é™¤](TROUBLESHOOTING.md) - å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- [API æ–‡æ¡£](eks-info-app/API_DOCUMENTATION.md) - å®Œæ•´çš„ API ä½¿ç”¨è¯´æ˜
- [Docker æ„å»ºæŒ‡å—](eks-info-app/DOCKER_BUILD_GUIDE.md) - Docker é•œåƒæ„å»ºè¯¦è§£
- [Kubernetes èµ„æºè¯´æ˜](k8s/README.md) - K8s èµ„æºé…ç½®è¯´æ˜
- [éœ€æ±‚æ–‡æ¡£](.kiro/specs/eks-info-webapp/requirements.md) - åŠŸèƒ½éœ€æ±‚è§„èŒƒ
- [è®¾è®¡æ–‡æ¡£](.kiro/specs/eks-info-webapp/design.md) - æ¶æ„è®¾è®¡æ–‡æ¡£
- [ä»»åŠ¡åˆ—è¡¨](.kiro/specs/eks-info-webapp/tasks.md) - å¼€å‘ä»»åŠ¡æ¸…å•

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œæµ‹è¯•ä½¿ç”¨ã€‚è¯·éµå®ˆ AWS æœåŠ¡æ¡æ¬¾å’Œç›¸å…³æ³•å¾‹æ³•è§„ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestã€‚

## è”ç³»æ–¹å¼

- **ä½œè€…**: RJ.Wang
- **é‚®ç®±**: wangrenjun@gmail.com
- **é¡¹ç›®**: EKS Info WebApp

---

**âš ï¸ é‡è¦æé†’**: 
- è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºé¡¹ç›®ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰è¯·è¿›è¡Œå……åˆ†çš„å®‰å…¨è¯„ä¼°å’Œé…ç½®è°ƒæ•´
- æµ‹è¯•å®Œæˆåè¯·åŠæ—¶è¿è¡Œ `./scripts/deploy.sh clean` æ¸…ç†èµ„æºï¼Œé¿å…äº§ç”Ÿä¸å¿…è¦çš„è´¹ç”¨
- é¢„ä¼°æˆæœ¬çº¦ $2-4/å°æ—¶ï¼Œè¯·æ³¨æ„æ§åˆ¶ä½¿ç”¨æ—¶é—´
