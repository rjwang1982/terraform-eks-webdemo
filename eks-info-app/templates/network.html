{% extends "base.html" %}

{% block title %}ç½‘ç»œä¿¡æ¯ - EKS Info WebApp{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ğŸŒ ç½‘ç»œæ¶æ„ä¿¡æ¯</h1>
    <p>æŸ¥çœ‹è¯¦ç»†çš„ç½‘ç»œé…ç½®å’Œå®‰å…¨ç­–ç•¥</p>
</div>

<div class="content" id="networkInfo">
    <!-- ç½‘ç»œä¿¡æ¯å°†é€šè¿‡ JavaScript åŠ è½½ -->
</div>
{% endblock %}

{% block extra_js %}
<script>
    // ä½œè€…: RJ.Wang
    // é‚®ç®±: wangrenjun@gmail.com
    // åˆ›å»ºæ—¶é—´: 2025-11-14
    
    // åŠ è½½ç½‘ç»œä¿¡æ¯
    async function loadNetworkInfo() {
        try {
            const data = await apiRequest('/network/');
            displayNetworkInfo(data);
        } catch (error) {
            console.error('åŠ è½½ç½‘ç»œä¿¡æ¯å¤±è´¥:', error);
        }
    }
    
    // æ˜¾ç¤ºç½‘ç»œä¿¡æ¯
    function displayNetworkInfo(data) {
        const container = document.getElementById('networkInfo');
        let html = '';
        
        // VPC ä¿¡æ¯
        if (data.vpc_info) {
            const vpc = data.vpc_info;
            html += `
                <div class="card">
                    <div class="card-header">ğŸ¢ VPC ä¿¡æ¯</div>
                    <div class="card-body">
                        <table class="table">
                            <tr><th>VPC ID</th><td>${vpc.vpc_id || 'N/A'}</td></tr>
                            <tr><th>CIDR å—</th><td>${vpc.cidr_block || 'N/A'}</td></tr>
                            <tr><th>çŠ¶æ€</th><td><span class="status-badge ${getStatusClass(vpc.state || 'unknown')}">${vpc.state || 'N/A'}</span></td></tr>
                            <tr><th>DNS æ”¯æŒ</th><td>${vpc.enable_dns_support ? 'âœ… å¯ç”¨' : 'âŒ ç¦ç”¨'}</td></tr>
                            <tr><th>DNS ä¸»æœºå</th><td>${vpc.enable_dns_hostnames ? 'âœ… å¯ç”¨' : 'âŒ ç¦ç”¨'}</td></tr>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // å­ç½‘ä¿¡æ¯
        if (data.subnets && data.subnets.length > 0) {
            html += `
                <div class="card">
                    <div class="card-header">ğŸ”Œ å­ç½‘ä¿¡æ¯</div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>å­ç½‘ ID</th>
                                    <th>CIDR</th>
                                    <th>å¯ç”¨åŒº</th>
                                    <th>ç±»å‹</th>
                                    <th>å¯ç”¨ IP</th>
                                    <th>çŠ¶æ€</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            data.subnets.forEach(subnet => {
                html += `
                    <tr>
                        <td>${subnet.subnet_id || 'N/A'}</td>
                        <td>${subnet.cidr_block || 'N/A'}</td>
                        <td>${subnet.availability_zone || 'N/A'}</td>
                        <td><span class="status-badge ${subnet.map_public_ip ? 'info' : 'success'}">${subnet.map_public_ip ? 'å…¬æœ‰' : 'ç§æœ‰'}</span></td>
                        <td>${subnet.available_ip_count || 0}</td>
                        <td><span class="status-badge ${getStatusClass(subnet.state || 'unknown')}">${subnet.state || 'N/A'}</span></td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // å®‰å…¨ç»„ä¿¡æ¯
        if (data.security_groups && data.security_groups.length > 0) {
            html += `
                <div class="card">
                    <div class="card-header">ğŸ”’ å®‰å…¨ç»„è§„åˆ™</div>
                    <div class="card-body">
            `;
            
            data.security_groups.forEach(sg => {
                html += `
                    <h4>${sg.group_name} (${sg.group_id})</h4>
                    <p>${sg.description}</p>
                    
                    <h5>å…¥ç«™è§„åˆ™</h5>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>åè®®</th>
                                <th>ç«¯å£èŒƒå›´</th>
                                <th>æ¥æº</th>
                                <th>æè¿°</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                if (sg.ingress_rules && sg.ingress_rules.length > 0) {
                    sg.ingress_rules.forEach(rule => {
                        html += `
                            <tr>
                                <td>${rule.protocol || 'N/A'}</td>
                                <td>${rule.from_port || 'N/A'} - ${rule.to_port || 'N/A'}</td>
                                <td>${rule.source || 'N/A'}</td>
                                <td>${rule.description || '-'}</td>
                            </tr>
                        `;
                    });
                } else {
                    html += '<tr><td colspan="4">æ— å…¥ç«™è§„åˆ™</td></tr>';
                }
                
                html += `
                        </tbody>
                    </table>
                    
                    <h5>å‡ºç«™è§„åˆ™</h5>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>åè®®</th>
                                <th>ç«¯å£èŒƒå›´</th>
                                <th>ç›®æ ‡</th>
                                <th>æè¿°</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                if (sg.egress_rules && sg.egress_rules.length > 0) {
                    sg.egress_rules.forEach(rule => {
                        html += `
                            <tr>
                                <td>${rule.protocol || 'N/A'}</td>
                                <td>${rule.from_port || 'N/A'} - ${rule.to_port || 'N/A'}</td>
                                <td>${rule.destination || 'N/A'}</td>
                                <td>${rule.description || '-'}</td>
                            </tr>
                        `;
                    });
                } else {
                    html += '<tr><td colspan="4">æ— å‡ºç«™è§„åˆ™</td></tr>';
                }
                
                html += `
                        </tbody>
                    </table>
                    <hr>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
        }
        
        // Load Balancer ä¿¡æ¯
        if (data.load_balancers && data.load_balancers.length > 0) {
            html += `
                <div class="card">
                    <div class="card-header">âš–ï¸ Load Balancer ä¿¡æ¯</div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>åç§°</th>
                                    <th>ç±»å‹</th>
                                    <th>DNS åç§°</th>
                                    <th>çŠ¶æ€</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            data.load_balancers.forEach(lb => {
                html += `
                    <tr>
                        <td>${lb.name || 'N/A'}</td>
                        <td><span class="status-badge info">${lb.type || 'N/A'}</span></td>
                        <td>${lb.dns_name || 'N/A'}</td>
                        <td><span class="status-badge ${getStatusClass(lb.state || 'unknown')}">${lb.state || 'N/A'}</span></td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        container.innerHTML = html;
    }
    
    // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
    document.addEventListener('DOMContentLoaded', loadNetworkInfo);
</script>
{% endblock %}
