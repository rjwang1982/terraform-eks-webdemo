{% extends "base.html" %}

{% block title %}é¦–é¡µ - EKS Info WebApp{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ğŸ  EKS ç¯å¢ƒä¿¡æ¯</h1>
    <p>æŸ¥çœ‹å½“å‰ EKS ç¯å¢ƒçš„å®Œæ•´ä¿¡æ¯</p>
</div>

<div class="content">
    <div id="environmentInfo">
        <!-- ç¯å¢ƒä¿¡æ¯å°†é€šè¿‡ JavaScript åŠ è½½ -->
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // ä½œè€…: RJ.Wang
    // é‚®ç®±: wangrenjun@gmail.com
    // åˆ›å»ºæ—¶é—´: 2025-11-14
    
    // åŠ è½½ç¯å¢ƒä¿¡æ¯
    async function loadEnvironmentInfo() {
        try {
            const data = await apiRequest('/');
            displayEnvironmentInfo(data);
        } catch (error) {
            console.error('åŠ è½½ç¯å¢ƒä¿¡æ¯å¤±è´¥:', error);
        }
    }
    
    // æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
    function displayEnvironmentInfo(data) {
        const container = document.getElementById('environmentInfo');
        
        let html = '';
        
        // åº”ç”¨ä¿¡æ¯
        if (data.app) {
            html += `
                <div class="card">
                    <div class="card-header">ğŸ“± åº”ç”¨ä¿¡æ¯</div>
                    <div class="card-body">
                        <table class="table">
                            <tr><th>åº”ç”¨åç§°</th><td>${data.app.name}</td></tr>
                            <tr><th>ç‰ˆæœ¬</th><td>${data.app.version}</td></tr>
                            <tr><th>æè¿°</th><td>${data.app.description}</td></tr>
                            <tr><th>ä½œè€…</th><td>${data.app.author}</td></tr>
                            <tr><th>é‚®ç®±</th><td>${data.app.email}</td></tr>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // Pod ä¿¡æ¯
        if (data.environment && data.environment.pod) {
            const pod = data.environment.pod;
            html += `
                <div class="card">
                    <div class="card-header">ğŸ”· Pod ä¿¡æ¯</div>
                    <div class="card-body">
                        <table class="table">
                            <tr><th>Pod åç§°</th><td>${pod.name || 'N/A'}</td></tr>
                            <tr><th>å‘½åç©ºé—´</th><td>${pod.namespace || 'N/A'}</td></tr>
                            <tr><th>Pod IP</th><td>${pod.ip || 'N/A'}</td></tr>
                            <tr><th>èŠ‚ç‚¹åç§°</th><td>${pod.node_name || 'N/A'}</td></tr>
                            <tr><th>æœåŠ¡è´¦å·</th><td>${pod.service_account || 'N/A'}</td></tr>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // é›†ç¾¤ä¿¡æ¯
        if (data.environment && data.environment.cluster) {
            const cluster = data.environment.cluster;
            html += `
                <div class="card">
                    <div class="card-header">â˜¸ï¸ Kubernetes é›†ç¾¤ä¿¡æ¯</div>
                    <div class="card-body">
                        <table class="table">
                            <tr><th>Kubernetes ç‰ˆæœ¬</th><td>${cluster.version || 'N/A'}</td></tr>
                            <tr><th>API æœåŠ¡å™¨</th><td>${cluster.api_server || 'N/A'}</td></tr>
                            <tr><th>é›†ç¾¤åç§°</th><td>${cluster.name || 'N/A'}</td></tr>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // EC2 å®ä¾‹ä¿¡æ¯
        if (data.environment && data.environment.ec2) {
            const ec2 = data.environment.ec2;
            html += `
                <div class="card">
                    <div class="card-header">ğŸ–¥ï¸ EC2 å®ä¾‹ä¿¡æ¯</div>
                    <div class="card-body">
                        <table class="table">
                            <tr><th>å®ä¾‹ ID</th><td>${ec2.instance_id || 'N/A'}</td></tr>
                            <tr><th>å®ä¾‹ç±»å‹</th><td>${ec2.instance_type || 'N/A'}</td></tr>
                            <tr><th>å¯ç”¨åŒº</th><td>${ec2.availability_zone || 'N/A'}</td></tr>
                            <tr><th>ç§æœ‰ IP</th><td>${ec2.private_ip || 'N/A'}</td></tr>
                            <tr><th>å…¬æœ‰ IP</th><td>${ec2.public_ip || 'N/A'}</td></tr>
                            <tr><th>åŒºåŸŸ</th><td>${ec2.region || 'N/A'}</td></tr>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // ç³»ç»Ÿæ¶æ„ä¿¡æ¯
        if (data.environment && data.environment.system) {
            const system = data.environment.system;
            html += `
                <div class="card">
                    <div class="card-header">âš™ï¸ ç³»ç»Ÿæ¶æ„ä¿¡æ¯</div>
                    <div class="card-body">
                        <table class="table">
                            <tr><th>CPU æ¶æ„</th><td>${system.architecture || 'N/A'}</td></tr>
                            <tr><th>å¤„ç†å™¨</th><td>${system.processor || 'N/A'}</td></tr>
                            <tr><th>ARM64</th><td>${system.is_arm64 ? '<span class="status-badge success">æ˜¯</span>' : '<span class="status-badge info">å¦</span>'}</td></tr>
                            <tr><th>æ“ä½œç³»ç»Ÿ</th><td>${system.os || 'N/A'}</td></tr>
                            <tr><th>Python ç‰ˆæœ¬</th><td>${system.python_version || 'N/A'}</td></tr>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // ç½‘ç»œæ¶æ„ä¿¡æ¯
        if (data.environment && data.environment.network) {
            const network = data.environment.network;
            html += `
                <div class="card">
                    <div class="card-header">ğŸŒ ç½‘ç»œæ¶æ„ä¿¡æ¯</div>
                    <div class="card-body">
                        <table class="table">
                            <tr><th>VPC ID</th><td>${network.vpc_id || 'N/A'}</td></tr>
                            <tr><th>å­ç½‘ ID</th><td>${network.subnet_id || 'N/A'}</td></tr>
                            <tr><th>å®‰å…¨ç»„</th><td>${network.security_groups ? network.security_groups.join(', ') : 'N/A'}</td></tr>
                            <tr><th>MAC åœ°å€</th><td>${network.mac_address || 'N/A'}</td></tr>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // ç¯å¢ƒå˜é‡
        if (data.environment && data.environment.environment_variables) {
            const envVars = data.environment.environment_variables;
            html += `
                <div class="card">
                    <div class="card-header">ğŸ“‹ ç¯å¢ƒå˜é‡</div>
                    <div class="card-body">
                        <table class="table">
            `;
            
            for (const [key, value] of Object.entries(envVars)) {
                html += `<tr><th>${key}</th><td>${value}</td></tr>`;
            }
            
            html += `
                        </table>
                    </div>
                </div>
            `;
        }
        
        container.innerHTML = html;
    }
    
    // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
    document.addEventListener('DOMContentLoaded', loadEnvironmentInfo);
</script>
{% endblock %}
